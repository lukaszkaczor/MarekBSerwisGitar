@using System.Security.Principal
@using SerwisGitar.Models.DbModels
@model List<SerwisGitar.Models.DbModels.ShoppingCart>

@{
    ViewBag.Title = "Koszyk";
    decimal total = 0;
}


@if (Model.Count == 0)
{
    <h1>Koszyk jest pusty</h1>
}
else
{
    <h2>Koszyk</h2>

    <table class="table table-striped">
        <tr>
            <th style="width: 50%">
                Nazwa
            </th>
            <th>
                Cena
            </th>
            <th class="center">Usuń</th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>

                <td style="width: 75%">
                    @if (item.CustomInstrumentId != null)
                    {
                        <a href="#" style="text-decoration: none">@(item.CustomInstrument.Instrument.Name) - instrument spersonalizowany (kliknij, aby zobaczyć szczegóły)</a>
                    }
                    else
                    {
                        <p>@item.ServiceDescription</p>

                        <p>@(item.Service?.ServiceType?.Name): @(item.Service?.Name) - @(item.Instrument.Name)</p>

                    }
                </td>
                <td>
                    @if (item.CustomInstrumentId != null)
                    {
                        <p>Do uzgodnienia</p>
                    }
                    else
                    {
                        <p>~@(item.Service?.Price.ToString("F")) zł</p>
                    }
                    @*~@(item.Service?.Price.ToString("F")) zł*@


                    @if (item.Service != null)
                    {
                        total += item.Service.Price;
                    }

                </td>
                <td>
                    @using (Html.BeginForm("DeleteFromCart", "ShoppingCart", FormMethod.Post, new { @class = "center" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.Hidden("itemId", item.ServiceId)
                        @Html.Hidden("itemName", item.ServiceDescription)
                        @Html.Hidden("customInstrumentId", item.CustomInstrumentId)
                        <button style="margin: 0 auto" type="submit" class="btn btn-danger">x</button>
                    }
                </td>
            </tr>
        }


        <tr>
            <td></td>
            <td></td>
            <td class="center"><strong>Razem:&nbsp</strong>~@total.ToString("F") zł</td>
        </tr>

        <tr>
            <td></td>
            <td></td>
            <td><a href="@Url.Action("Index", "Orders")" class="btn btn-primary">Zarezerwuj termin</a></td>
        </tr>
    </table>
}

<style>

    p, td {
        margin: 0;
        padding: 0;
    }

    .center {
        display: flex;
        justify-content: center;
    }
    /*
    .right {
        display: flex;
        justify-content: flex-end;
    }*/
</style>